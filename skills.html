<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Engini - Select Skills</title>
    <link rel="icon" type="image/png" href="image.png"/>
    <link rel="stylesheet" href="style.css">
    <style>

        
        .btn,.cta-sales{
            height:36px;padding:0 14px;border-radius:10px;
            border:1px solid var(--line);background:var(--card);color:var(--ink);
            font-weight:600; 
            cursor:pointer;transition:box-shadow .2s,border-color .2s,background .2s
        }
        .btn:hover{box-shadow:var(--shadow-sm);border-color:var(--line-strong)}
        .btn.primary{background:var(--primary);color:var(--primary-ink);border-color:var(--primary)}
        .btn.danger{color:#ef4444;border-color:#fecaca;background:var(--card)}
        .btn.danger:hover{background:rgba(239,68,68,.06);border-color:#fca5a5}

        .back{
            text-decoration:none;display:inline-flex;align-items:center;
            height:38px;padding:0 14px;border-radius:10px;
            border:1px solid var(--line);background:var(--card);color:var(--ink);
            font-weight: 600; 
        }

        input,textarea{font:inherit;color:var(--ink)}
        .field{width:100%;padding:10px;border:1px solid var(--line);border-radius:10px;background:var(--card)}

        
        .h1{font-size:30px;line-height:1.2;margin:22px 0 6px}
        .muted{color:var(--muted)}
        .hero{display:flex;align-items:center;gap:12px;margin:14px 0 6px}
        .hero img{width:56px;height:56px;border-radius:999px;border:2px solid var(--line);object-fit:cover;background:var(--card)}

        
        .glass-card{
            max-width: 1200px; 
            width: 100%; 
            margin: 0 auto; 
            background:var(--glass-strong);
            backdrop-filter: blur(6px);
            border:1px solid var(--line);
            border-radius:14px;
            box-shadow:var(--shadow);
            padding:14px;
        }
        .page-center{display:flex;align-items:center;justify-content:center;padding:20px}

        .head-row{display:flex;gap:12px;align-items:center;justify-content:space-between;margin-bottom:10px;flex-wrap:wrap}
        .titleblock{display:flex;flex-direction:column}
        .title{font-size:22px;font-weight:600;} 
        .wc-badge{letter-spacing:.12em;color:var(--muted);font-weight:600;font-size:11px} 
        .wc-divider{height:1px;background:linear-gradient(90deg,transparent,var(--line),transparent);margin:.6rem 0}
        .count{font-weight:600;} 

        
        .header-inner {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
            height: 64px;
            gap: 12px;
        }
        .brand { font-weight: 500; } 
        .progress { font-weight: 500; } 
        .progress .active { font-weight: 600; } 
        .header-actions { display: flex; align-items: center; justify-content: flex-end; gap: 10px; }

        
        .list-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px 12px}
        @media (max-width:760px){.list-grid{grid-template-columns:1fr}}

        .skill-row{
            display:flex;align-items:center;justify-content:space-between;
            padding:12px;border:1px solid var(--line);border-radius:12px;background:var(--card);
            transition:border-color .18s, box-shadow .18s, background .18s;
            min-height:72px;cursor:pointer
        }
        .skill-row:hover{border-color:var(--line-strong)}
        .skill-row.is-selected{border-color:var(--primary);box-shadow:0 0 0 2px var(--ring) inset;background:rgba(59,130,246,.06)}
        html.dark-mode .skill-row.is-selected{background:rgba(59,130,246,.12)}

        .skill-left{display:flex;align-items:center;gap:10px;flex:1}
        .check{
            width:18px;height:18px;border-radius:6px;border:2px solid var(--primary);
            display:grid;place-items:center;background:var(--card);color:#fff;flex-shrink:0
        }
        .check svg{display:none}
        .skill-row.is-selected .check{background:var(--primary)}
        .skill-row.is-selected .check svg{display:block}

        .skill-title{font-weight:600;} 
        .skill-meta{display:flex;align-items:center;gap:6px;margin-top:2px;font-size:12px;color:var(--muted)}
        .pill{display:inline-flex;align-items:center;border-radius:999px;border:1px solid var(--line);padding:4px 8px;font-size:12px;font-weight:600;} 
        .pill.included{border-color:transparent;background:#e8faef;color:#0f5132}
        .pill.extra{background:var(--card);color:#374151}

        
        .modal-backdrop{position:fixed;inset:0;background:var(--backdrop);display:none;align-items:center;justify-content:center;z-index:120;backdrop-filter:blur(3px)}
        .modal-backdrop.show{display:flex}
        .modal{
            width:min(760px,94vw);background:var(--card);border:1px solid var(--line);border-radius:12px;
            box-shadow:0 24px 60px rgba(0,0,0,.18);overflow:hidden;color:var(--ink)
        }
        .modal header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid var(--line)}
        .modal .h3{font-weight:600;} 
        .modal .scroll{max-height:62vh;overflow:auto;padding:14px}
        .modal .close{background:transparent;border:0;font-size:20px;cursor:pointer;color:var(--ink)}
        .row-between{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 14px;border-top:1px solid var(--line)}
    </style>
</head>
<body>

    <header class="header">
        <div class="header-inner container">
            <div class="brand">
                <img id="brandLogo" src="logo.png" alt="Engini logo">
            </div>

            <div class="progress" aria-label="progress">
                <span data-step="1"><span class="dot"></span> Select Worker</span>
                <span>›</span>
                <span data-step="2" class="active"><span class="dot"></span> Select Skills</span>
                <span>›</span>
                <span data-step="3"><span class="dot"></span> Onboard</span>
                <span>›</span>
                <span data-step="4"><span class="dot"></span> Chat Workspace</span>
            </div>

            <div class="header-actions">
                <button class="btn" id="btnTalkSales" type="button">Talk to Sales</button>
                <button class="btn" id="themeToggle" type="button">Dark mode</button>
            </div>
        </div>
    </header>

    <main class="container">
        <section class="hero">
            <img id="workerAvatar" src="" alt="Worker">
            <div class="titleblock">
                <h1 class="h1" style="margin:0">Select up to 10 Skills</h1>
                <div id="workerDesc" class="muted"></div>
            </div>
        </section>

        <div class="page-center">
            <div class="glass-card">
                <div class="head-row">
                    <div class="titleblock">
                        <div id="workerName" class="title">Worker</div>
                    </div>
                    <div class="count">Selected: <span id="countSel">0</span> / 10</div>
                    <div style="display:flex;gap:8px;flex-wrap:wrap">
                        <button id="btnAddCustom" class="btn">Add custom skill</button>
                        <button id="btnClear" class="btn danger">Clear all</button>
                    </div>
                </div>

                <div class="wc-divider"></div>
                <div id="chips" class="list-grid" aria-live="polite"></div>

                <div class="wc-divider" style="margin-top:12px"></div>
                <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;margin-top:10px">
                    <a href="index.html" class="back">Back to Workers</a>
                    <button id="btnContinue" class="btn primary">Continue</button>
                </div>
            </div>
        </div>
    </main>

    <div id="customModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="customTitle">
        <div class="modal" onclick="event.stopPropagation()">
            <header>
                <div id="customTitle" class="h3">Add Custom Skill</div>
                <button class="close" onclick="closeModal('customModal')">×</button>
            </header>
            <div class="scroll">
                <input id="customSkillInput" class="field" placeholder="e.g., PO tracking, Supplier finder" />
                <p class="muted" style="margin-top:8px">Tip - keep skills short and action-oriented.</p>
            </div>
            <div class="row-between">
                <span class="muted">Skill will be marked as “(Custom)”</span>
                <div style="display:flex;gap:8px">
                    <button class="btn" onclick="closeModal('customModal')">Cancel</button>
                    <button id="customSkillSave" class="btn primary">Add</button>
                </div>
            </div>
        </div>
    </div>

    <div id="salesModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="salesTitle">
        <div class="modal" onclick="event.stopPropagation()">
            <header>
                <div id="salesTitle" class="h3">Talk to Sales</div>
                <button class="close" onclick="closeModal('salesModal')">×</button>
            </header>
            <div class="scroll">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                    <input class="field" placeholder="Name">
                    <input class="field" placeholder="Email">
                    <input class="field" placeholder="Company">
                    <input class="field" placeholder="Phone">
                </div>
                <textarea class="field" style="margin-top:10px;height:120px" placeholder="Tell us about your needs"></textarea>
            </div>
            <div class="row-between">
                <span class="muted">We’ll get back to you shortly.</span>
                <button class="btn primary" onclick="closeModal('salesModal')">Send</button>
            </div>
        </div>
    </div>

    <script>
        
        function openModal(id){ document.getElementById(id).classList.add('show'); }
        function closeModal(id){ document.getElementById(id).classList.remove('show'); }
        function getLS(k, fallback=null){ try{ return JSON.parse(localStorage.getItem(k) || JSON.stringify(fallback)); }catch{ return fallback; } }
        function setLS(k, v){ localStorage.setItem(k, JSON.stringify(v)); }
        function uiAvatar(name){ return `https://ui-avatars.com/api/?name=${encodeURIComponent(name||'AI')}&background=1F2937&color=E5E7EB&size=96&bold=true`; }

        
        const STEP_URLS = { 1:'index.html', 2:'skills.html', 3:'onboard.html', 4:'chat.html' };
        document.querySelectorAll('.progress [data-step]').forEach(el=>{
            el.addEventListener('click', ()=>{
                const step = Number(el.dataset.step);
                const url = STEP_URLS[step] || 'index.html';
                window.location.href = url;
            });
        });

        
        const themeToggle = document.getElementById('themeToggle');
        const html = document.documentElement;
        const brandLogo = document.querySelector('.brand img'); // Select the image element

        function updateLogo(isDark) {
            brandLogo.src = isDark ? 'logo_light.png' : 'logo.png';
        }

        // Load saved theme and set logo
        const isDarkInitial = localStorage.getItem('theme') === 'dark';
        if (isDarkInitial) {
            html.classList.add('dark-mode');
            themeToggle.textContent = 'Light Mode';
        } else {
            themeToggle.textContent = 'Dark mode';
        }
        updateLogo(isDarkInitial);

        themeToggle.addEventListener('click', () => {
            html.classList.toggle('dark-mode');
            const isDark = html.classList.contains('dark-mode');
            
            themeToggle.textContent = isDark ? 'Light Mode' : 'Dark mode';
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            updateLogo(isDark);
        });

        
        document.getElementById('btnTalkSales').onclick = () => openModal('salesModal');

        
        const LS_KEYS = { WORKER:'engini.selectedWorker', SKILLS:'engini.selectedSkills', PRICING:'engini.pricing' };

        const WORKER_SKILLS = {
            procurement: [
                'Invoice capture (OCR/EDI)','Duplicate supplier/invoice detection','2/3-Way Match (Invoice ↔ PO ↔ GR)','PO & supplier validation',
                'GL / cost center coding','Tax/VAT compliance checks','Exception flagging & routing','Payment proposal creation',
                'Execute supplier payments','Vendor statement reconciliation','Contract renewal monitoring','Supplier performance tracking',
                'Policy enforcement','Audit-ready AP reporting'
            ],
            finance: [
                'Bank reconciliation','Recurring journal entries','Month-end data consolidation','Accruals & reclasses','AP/AR aging reports',
                'Expense anomaly detection','Cash flow forecasting','Trial balance drafts','VAT/GST reporting','P&L by cost center',
                'Payment batch scheduling','Payroll to GL integration','Variance analysis','DSO/DPO/OPEX KPI tracking'
            ],
            hr: [
                'New-hire onboarding (accounts/systems)','HRIS record creation','Access provisioning/deprovisioning','PTO/leave automation',
                'Payslip/tax form generation','Compliance training reminders','HR ticket FAQ resolution','Performance review reminders',
                'Training completion tracking','Org chart updates','Headcount & attrition reports','Benefits enrollment',
                'Expense reimbursement processing','HR policy compliance checks'
            ],
            it: [
                'Auto-triage incoming tickets','Password resets','Account unlocks','Incident categorization/prioritization',
                'Close duplicates/low-value tickets','Software package deployment','Security patching','User provisioning/deprovisioning',
                'Intelligent ticket routing','SLA/MTTR KPI reporting','Asset inventory maintenance','Compliance/security scans',
                'Weekly IT ops reports','Uptime/alert monitoring'
            ],
            aml: [
                'Sanctions/PEP Alert Triage','False-positive suppression','Payments sanctions screening','AML transaction monitoring (L1 review)',
                'KYC/KYB onboarding docs','Entity resolution & de-duplication','Watchlist/data enrichment','Adverse media monitoring',
                'Case assembly & EDD pack','Risk scoring & KYC refresh','Narrative generation (GenAI)','SAR/STR drafting assist',
                'Quality assurance & audit trail','Workload prioritization & SLA'
            ],
            custom: []
        };

        const MAX_SELECT = 10;
        const BASE_INCLUDED = 5;
        const BASE_PRICE = 2000;
        const EXTRA_PRICE = 250;

        const chipsEl = document.getElementById('chips');
        const countSel = document.getElementById('countSel');
        const btnContinue = document.getElementById('btnContinue');
        const btnClear = document.getElementById('btnClear');
        const btnAddCustom = document.getElementById('btnAddCustom');
        const workerName = document.getElementById('workerName');
        const workerDesc = document.getElementById('workerDesc');
        const workerAvatar = document.getElementById('workerAvatar');

        const selWorker = getLS(LS_KEYS.WORKER, null);
        if(!selWorker){ window.location.href = 'index.html'; }

        workerName.textContent = selWorker?.name || 'Worker';
        workerAvatar.src = getLS('engini.workerAvatar', uiAvatar(selWorker?.name));
        workerAvatar.onerror = () => { workerAvatar.src = uiAvatar(selWorker?.name); };

        let allSkills = [...(WORKER_SKILLS[selWorker.id] || [])];
        let selectedSkills = getLS(LS_KEYS.SKILLS, null);
        if(!selectedSkills){
            selectedSkills = allSkills.slice(0, Math.min(BASE_INCLUDED, allSkills.length));
        }else{
            selectedSkills = selectedSkills.filter(s => allSkills.includes(s) || s.endsWith('(Custom)'));
        }

        function skillRowTemplate(label, index, isSelected){
            return `
                <div class="skill-row ${isSelected ? 'is-selected' : ''}" data-skill="${encodeURIComponent(label)}">
                    <div class="skill-left">
                        <div class="check" role="checkbox" aria-checked="${isSelected}">
                            <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 6 9 17l-5-5"></path>
                            </svg>
                        </div>
                        <div>
                            <div class="skill-title">${label}</div>
                        </div>
                    </div>
                </div>`;
        }

        function renderSkills(){
            const frag = document.createDocumentFragment();
            allSkills.forEach((s, i)=>{
                const wrapper = document.createElement('div');
                wrapper.innerHTML = skillRowTemplate(s, i, selectedSkills.includes(s));
                frag.appendChild(wrapper.firstElementChild);
            });
            chipsEl.innerHTML = '';
            chipsEl.appendChild(frag);

            chipsEl.querySelectorAll('.skill-row').forEach(row=>{
                const label = decodeURIComponent(row.getAttribute('data-skill'));
                const box = row.querySelector('.check');
                const toggle = ()=>{
                    const isSelected = selectedSkills.includes(label);
                    if(isSelected){
                        selectedSkills = selectedSkills.filter(x=>x!==label);
                    }else{
                        if(selectedSkills.length >= MAX_SELECT) return;
                        selectedSkills.push(label);
                    }
                    setLS(LS_KEYS.SKILLS, selectedSkills);
                    updatePricing();
                    row.classList.toggle('is-selected');
                    row.querySelector('.check').setAttribute('aria-checked', String(!isSelected));
                };
                row.addEventListener('click', (e)=>{ if(e.target.closest('.check') || e.target.closest('.skill-left')) toggle(); });
                box.addEventListener('click', (e)=>{ e.stopPropagation(); toggle(); });
            });

            updatePricing();
        }

        function updatePricing(){
            const count = selectedSkills.length;
            countSel.textContent = count;
            const extraCount = Math.max(0, count - BASE_INCLUDED);
            const extra = extraCount * EXTRA_PRICE;
            const total = BASE_PRICE + extra;
            setLS(LS_KEYS.PRICING, {base:BASE_PRICE, extra, total, count});
        }

        btnClear.addEventListener('click', ()=>{
            selectedSkills = [];
            setLS(LS_KEYS.SKILLS, selectedSkills);
            renderSkills();
        });

        const customSkillInput = document.getElementById('customSkillInput');
        const customSkillSave = document.getElementById('customSkillSave');

        btnAddCustom.addEventListener('click', ()=>{
            if(allSkills.length >= 14){
                alert('You already have 14 skills in the list. Remove one to add a custom skill.');
                return;
            }
            customSkillInput.value = '';
            openModal('customModal');
            requestAnimationFrame(()=> customSkillInput.focus());
        });

        customSkillSave.addEventListener('click', ()=>{
            const name = (customSkillInput.value||'').trim();
            if(!name){ customSkillInput.focus(); return; }
            const label = `${name} (Custom)`;
            if(allSkills.length < 14){
                allSkills.push(label);
                if(selectedSkills.length < MAX_SELECT){ selectedSkills.push(label); }
                setLS(LS_KEYS.SKILLS, selectedSkills);
                renderSkills();
            }
            closeModal('customModal');
        });

        btnContinue.addEventListener('click', ()=>{
            const extraCount = Math.max(0, selectedSkills.length - BASE_INCLUDED);
            setLS(LS_KEYS.PRICING, {
                base: BASE_PRICE,
                extra: extraCount * EXTRA_PRICE,
                total: BASE_PRICE + extraCount * EXTRA_PRICE,
                count: selectedSkills.length
            });
            window.location.href = 'onboard.html';
        });

        renderSkills();
    </script>
</body>
</html>